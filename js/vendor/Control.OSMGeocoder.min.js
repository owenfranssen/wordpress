"undefined"==typeof console&&(this.console={log:function(msg){}}),L.Control.OSMGeocoder=L.Control.extend({options:{collapsed:!0,position:"topright",text:"Locate",placeholder:"",bounds:null,email:null,callback:function(results){if(0!=results.length){var bbox=results[0].boundingbox,first=new L.LatLng(bbox[0],bbox[2]),second=new L.LatLng(bbox[1],bbox[3]),bounds=new L.LatLngBounds([first,second]);this._map.fitBounds(bounds)}else console.log("ERROR: didn't find a result")}},_callbackId:0,initialize:function(options){L.Util.setOptions(this,options)},onAdd:function(map){this._map=map;var className="leaflet-control-geocoder",container=this._container=L.DomUtil.create("div",className);L.DomEvent.disableClickPropagation(container);var form=this._form=L.DomUtil.create("form",className+"-form"),input=this._input=document.createElement("input");input.type="text",input.placeholder=this.options.placeholder||"";var submit=document.createElement("input");if(submit.type="submit",submit.value=this.options.text,form.appendChild(input),form.appendChild(submit),L.DomEvent.addListener(form,"submit",this._geocode,this),this.options.collapsed){L.DomEvent.addListener(container,"click",this._expand,this);var link=this._layersLink=L.DomUtil.create("a",className+"-toggle",container);link.href="#",link.title="Nominatim Geocoder",L.DomEvent.addListener(link,L.Browser.touch?"click":"focus",this._expand,this),this._map.on("movestart",this._collapse,this)}else this._expand();return container.appendChild(form),container},_createSearchResult:function(lat,lon){var diff=.005,result=[];return result[0]={},result[0].boundingbox=[parseFloat(lat)-.005,parseFloat(lat)+.005,parseFloat(lon)-.005,parseFloat(lon)+.005],result[0].class="boundary",result[0].display_name="Position: "+lat+" "+lon,result[0].lat=lat,result[0].lon=lon,result},_isLatLon:function(q){var re=/(-?\d+\.\d+)\s(-?\d+\.\d+)/,m=re.exec(q);return null!=m?m:null!=(m=(re=/lat\D*(-?\d+\.\d+)\D*lon\D*(-?\d+\.\d+)/).exec(q))?m:null},_isLatLon_decMin:function(q){return console.log("is LatLon?: "+q),re=/([ns])\s*(\d+)\D*(\d+\.\d+).?\s*([ew])\s*(\d+)\D*(\d+\.\d+)/i,m=re.exec(q.toLowerCase()),null!=m?m:null},_geocode:function(event){L.DomEvent.preventDefault(event);var q=this._input.value;if(null!=this._isLatLon(q)){var m=this._isLatLon(q);return console.log("LatLon: "+m[1]+" "+m[2]),void this.options.callback.call(this,this._createSearchResult(m[1],m[2]))}if(null!=this._isLatLon_decMin(q)){var m=this._isLatLon_decMin(q),temp=new Array;return temp.n=1,temp.s=-1,temp.e=1,temp.w=-1,void this.options.callback.call(this,this._createSearchResult(temp[m[1]]*(Number(m[2])+m[3]/60),temp[m[4]]*(Number(m[5])+m[6]/60)))}console.log("callback ID:"+this._callbackId),window["_l_osmgeocoder_"+this._callbackId]=L.Util.bind(this.options.callback,this);var params={q:this._input.value,json_callback:"_l_osmgeocoder_"+this._callbackId++,format:"json"};if(this.options.bounds&&null!=this.options.bounds){if(!(this.options.bounds instanceof L.LatLngBounds))return void console.log("bounds must be of type L.LatLngBounds");params.viewbox=this.options.bounds.toBBoxString(),params.bounded=1}this.options.email&&null!=this.options.email&&("string"==typeof this.options.email?params.email=this.options.email:console.log("email must be a string"));var protocol=location.protocol;"file:"==protocol&&(protocol="https:");var url=protocol+"//nominatim.openstreetmap.org/search"+L.Util.getParamString(params),script=document.createElement("script");script.type="text/javascript",script.src=url,script.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(script)},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-geocoder-expanded","")}});